#### Traditional FS

1. ##### Основы

    ФС имеет интерфейс для обращения к ядру: за этот счет достигается модульность типов ФС

    Традиционные ФС: UFS (Unix FS), EXT4, XFS

    Продвинутые: ZFS, BtrFs

2. ##### Традиционные ФС

    Основная идея современных журнальных ФС состоит в том, чтобы уцелеть после сбоев (к примеру, после сбоев электроэнергии): для этого сначала изменения вносятся в журнал, как только изменения вступили в силу на уровне журнала, делается запись о завершении фиксации данных ("commit record"), и только потом обновляется сама ФС, таким образом поддерживается логирование журнала и возможность восстановить запись в ФС. Благодаря такому подходу проверка ФС длится около секунды (`fsck`). Журналы появились в ext3.

    Ext4 ввела "extents" (диапозоны блоков диска) взамен фиксированных блоков.

    К примеру, мы можем смонтировать раздел начинающий с сектора 34607104:

    `mount -o offset=$((512*34607104)) /dev/sdX /mnt/foo/` - даже при отсуствии раздела на данном диапозоне.

    XFS зародилась в Silicon Graphics, Inc (SGI) и служила для обработки медиафайлов большого размер (теперь стандарт в CentOS/Redhat).

3. #### Терминология

    *Inodes aka "index nodes"* - есть таблица фиксированного размера, и в ней хранятся эти самые inodes, которые в свою очередь содержат meta-данные о файлах: permission attributes, указатели на данные и т.д.

    *Super block* - хранит основные характеристики ФС (длину блока - группа секторов, размер таблицы inodes, disk block map - для отслеживания свободных блоков), данная информация резервируется самой ФС.

    Так как для ускорения работы ФС применяется кэш (блоки, inode, superblocks и т.д.), это значит данные в ФС записываются на диск не по щелчку (not write through). Из-за такого поведения существует вызов **sync** - для сброса кэша на диск. В итоге ФС может синхронизировать данные по расписанию либо отдавать на откуп ОС: современные ФС c журнализацией минимизируют возможность потери данных во время синхронизации при сбоях.

4. ##### Проверка и восстановление

    Для проверки ФС служит команда `fsck`, которая запускается при загрузки системы: главное правило - начать проверку с корневой системы. Отдельные разделы могут проверяться после некоторого кол-ва монтирования, для этого используется утилита:

    `tune2fs -c 50 /dev/sda3`

    lost+found - папка для хранения orphaned файлов (без записи в directory entries то есть безымянные, не существует ни одной hardlink на данные файлы) - см. https://pingvinus.ru/answers/1511

5. ##### fstab 

    - (1) - название устройства

    - (2) - точка монтирования

    - (3) - тип ФС

    - (4) - параметры монтирования: default, exec/noexec, user/nouser, sync/nosync, 

    - (5) - частота резервного копирования (deprecated)

    - (6) - fsck parallelism (0 - not check, 1 - только для root, 2 - для остальных разделов, проверка будет выполняться параллельно)

6. ##### Подписи (labels)

    - GPT
    
    `gpart show -l disk` - вывод подписи

    `gpart modify -i index -l label  disk` - установка подписи

    Подписи в GPT - отдельная история, не путать с подписями на уровне ФС: для их использования в fstab - PARTUUID= / PARTLABEL=

    - UFS

    `tunefs -p device` - вывод подписей

    `tunefs -L label device` - установка подписей

    Подписи можем использовать в fstab - LABEL=... - на месте UUID.

7. ##### Swap

    Рекомендованные соотношения

    Size = 1/2 RAM 

    Size >= 2GiB

    Команды:

    - `swapon`: посмотреть swap-конфигурацию - `swap -s` 

    - `swapoff`

    - `mkswap`
